---
layout: post
title: top命令详解
tags:
- Linux
categories: Linux
description: nginx
---

top命令经常用来监控[Linux](http://lib.csdn.net/base/linux)的系统状况

<!-- more --> 

## 1 命令使用

格式：

```shell
top [-] [d] [p] [q] [c] [C] [S] [s] [n]
```

参数说明

- **d : **指定每两次屏幕信息刷新之间的时间间隔。当然用户可以使用s交互命令来改变之。 
- **p : ** 通过指定监控进程ID来仅仅监控某个进程的状态。 
- **q : ** 该选项将使top没有任何延迟的进行刷新。如果调用程序有超级用户权限，那么top将以尽可能高的优先级运行。 
- **S ：** 指定累计模式 
- **s ：** 使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险。 
- **i ：** 使top不显示任何闲置或者僵死进程。 
- **c ：** 显示整个命令行而不只是显示命令名 

常用命令说明

下面介绍在top命令执行过程中可以使用的一些交互命令。从使用角度来看，熟练的掌握这些命令比掌握选项还重要一些。这些命令都是单字母的，如果在命令行选项中使用了s选项，则可能其中一些命令会被屏蔽掉。

- **Ctrl+L ：** 擦除并且重写屏幕。 
- **h或者? ：** 显示帮助画面，给出一些简短的命令总结说明。 
- **k ：**       终止一个进程。系统将提示用户输入需要终止的进程PID，以及需要发送给该进程什么样的信号。一般的终止进程可以使用15信号；如果不能正常结束那就使用信号9强制结束该进程。默认值是信号15。在安全模式中此命令被屏蔽。 
- **i ：** 忽略闲置和僵死进程。这是一个开关式命令。 
- **q ：** 退出程序。 
- **r ：** 重新安排一个进程的优先级别。系统提示用户输入需要改变的进程PID以及需要设置的进程优先级值。输入一个正值将使优先级降低，反之则可以使该进程拥有更高的优先权。默认值是10。 
- **S ：** 切换到累计模式。 
- **s ：** 改变两次刷新之间的延迟时间。系统将提示用户输入新的时间，单位为s。如果有小数，就换算成m s。输入0值则系统将不断刷新，默认值是5 s。需要注意的是如果设置太小的时间，很可能会引起不断刷新，从而根本来不及看清显示的情况，而且系统负载也会大大增加。 
- **f或者F ：** 从当前显示中添加或者删除项目。 
- **o或者O ：** 改变显示项目的顺序。 
- **l ：** 切换显示平均负载和启动时间信息。 
- **m ：** 切换显示内存信息。 
- **t ：** 切换显示进程和CPU状态信息。 
- **c ：** 切换显示命令名称和完整命令行。 
- **M ：** 根据驻留内存大小进行排序。 
- **P ：** 根据CPU使用百分比大小进行排序。 
- **T ：** 根据时间/累计时间进行排序。 
- **W ：** 将当前设置写入~/.toprc文件中。这是写top配置文件的推荐方法。

## 2 参数含义

输入top

```shell
top - 10:25:48 up 44 days, 14:33,  2 users,  load average: 0.21, 0.07, 0.06
Tasks:  75 total,   2 running,  73 sleeping,   0 stopped,   0 zombie
%Cpu(s):  1.3 us,  1.0 sy,  0.0 ni,97.3 id,  0.0 wa,  0.3 hi,  0.0 si,  0.0 st
KiB Mem :  1016164 total,    71696 free,   291808 used,   652660 buff/cache
KiB Swap:        0 total,        0 free,        0 used.   551348 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     
20023 root       0 -20  131044  12088   5108 S  0.3  1.2  91:03.75 AliYunDun   
    1 root      20   0   43460   3464   2192 S  0.0  0.3   0:37.34 systemd     
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.10 kthreadd    
    3 root      20   0       0      0      0 S  0.0  0.0   0:04.62 ksoftirqd/0 
```

### 1 系统运行时间和平均负载

```shell
top - 10:25:48 up 44 days, 14:33,  2 users,  load average: 0.21, 0.07, 0.06
```

10:25:48 — **当前系统时间**
up 44 days, 14:33 — **系统已经运行了44天14小时33分钟（在这期间没有重启过）**
2 users — **当前有2个用户登录系统**
load average: 0.21, 0.07, 0.06 — **load average后面的三个数分别是5分钟、10分钟、15分钟的负载情况。**

### 2 任务

```shell
Tasks:  75 total,   2 running,  73 sleeping,   0 stopped,   0 zombie
```

Tasks — 任务（进程），系统现在共有75个进程，其中处于运行中的有2个，73个在休眠（sleep），stoped状态的有0个，zombie状态（僵尸）的有0个。

### 3 cpu状态

```shell
%Cpu(s):  1.3 us,  1.0 sy,  0.0 ni,97.3 id,  0.0 wa,  0.3 hi,  0.0 si,  0.0 st
```

1.3% us — **用户空间占用CPU的百分比。**
1.0% sy — **内核空间占用CPU的百分比。**
0.0% ni — **改变过优先级的进程占用CPU的百分比**
97.3% id — **空闲CPU百分比**
0.0% wa — **IO等待占用CPU的百分比**
0.3% hi — **硬中断（Hardware IRQ）占用CPU的百分比**
0.0% si — **软中断（Software Interrupts）占用CPU的百分比**

### 4 内存使用

```shell
KiB Mem :  1016164 total,    71696 free,   291808 used,   652660 buff/cache
KiB Swap:        0 total,        0 free,        0 used.   551348 avail Mem 
```

接下来两行显示内存使用率，有点像'free'命令。第一行是物理内存使用，第二行是虚拟内存使用(交换空间)。

物理内存显示如下:全部可用内存、已使用内存、空闲内存、缓冲内存。相似地：交换部分显示的是：全部、已使用、空闲和缓冲交换空间。

内存显示可以用'm'命令切换。

1016164 total — 物理内存总量（1016M）
291808 used — 使用中的内存总量（291M）
71696 free — 空闲内存总量（71M）
652660 buffers — 缓存的内存量 （652M）

swap交换分区
0 total — 交换区总量（0M）
0 used — 使用的交换区总量（0M）
0 free — 空闲交换区总量（0M）

### 5 各进程（任务）的状态监控

```shell
  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     
20023 root       0 -20  131044  12088   5108 S  0.3  1.2  91:03.75 AliYunDun   
    1 root      20   0   43460   3464   2192 S  0.0  0.3   0:37.34 systemd     
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.10 kthreadd    
```

- PID：进程ID，进程的唯一标识符

- USER：进程所有者的实际用户名。

- PR：进程的调度优先级。这个字段的一些值是'rt'。这意味这这些进程运行在实时态。

- NI：进程的nice值（优先级）。越小的值意味着越高的优先级。负值表示高优先级，正值表示低优先级

- VIRT：进程使用的虚拟内存。进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES

- RES：驻留内存大小。驻留内存是任务使用的非交换物理内存大小。进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA

- SHR：SHR是进程使用的共享内存。共享内存大小，单位kb

- S：这个是进程的状态。它有以下不同的值:

  - D - 不可中断的睡眠态。

  - R – 运行态

  - S – 睡眠态

  - T – 被跟踪或已停止

  - Z – 僵尸态

- %CPU：自从上一次更新时到现在任务所使用的CPU时间百分比。

- %MEM：进程使用的可用物理内存百分比。

- TIME+：任务启动后到现在所使用的全部CPU时间，精确到百分之一秒。

- COMMAND：运行进程所使用的命令。进程名称（命令名/命令行）

### 3 常用操作

top   //每隔5秒显式所有进程的资源占用情况
top -d 2  //每隔2秒显式所有进程的资源占用情况
top -c  //每隔5秒显式进程的资源占用情况，并显示进程的命令行参数(默认只有进程名)
top -p 12345 -p 6789//每隔5秒显示pid是12345和pid是6789的两个进程的资源占用情况
top -d 2 -c -p 123456 //每隔2秒显示pid是12345的进程的资源使用情况，并显式该进程启动的命令行参数